<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Edvengers Student Hub</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="styles.css" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#020617">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
  </head>

  <body class="portal-body">
    <header class="ev-header">
      <div class="ev-container ev-nav">
        <div class="ev-logo">
          <span class="ev-logo-mark">E</span>
          <span class="ev-logo-text">Edvengers</span>
        </div>
        <nav class="ev-nav-links">
          <a href="index.html" class="btn btn-ghost btn-back">‚Üê Back to Main Site</a>
        </nav>
      </div>
    </header>

    <main>
      <section id="student-login-section">
        <div class="ev-container" style="padding: 2.5rem 0 3rem;">
          <h1>Student Login</h1>
          <p class="ev-helper-text">Welcome, Edvenger! Log in to access your HQ.</p>
          <div class="dashboard-card">
            <form id="student-login-form">
              <div class="form-field">
                <label for="login-name">Student Name</label>
                <input id="login-name" type="text" placeholder="e.g. Ethan Tan" required />
              </div>
              <div class="form-field">
                <label for="login-password">Password</label>
                <input id="login-password" type="password" required />
              </div>
              <p class="helper-text">Default password: <strong>heroes2026</strong></p>
              <p id="login-error" class="helper-text" style="color:#ff6b6b; display:none;"></p>
              <button type="submit" class="btn btn-primary">Enter Student Hub</button>
            </form>
          </div>
        </div>
      </section>

      <section id="student-password-section" style="display:none;">
        <div class="ev-container" style="padding: 2.5rem 0 3rem;">
          <h1>One Last Step!</h1>
          <p class="ev-helper-text">Please set your secret password.</p>
          <div class="dashboard-card">
            <form id="change-password-form">
              <div class="form-field">
                <label for="new-password">New Secret Password</label>
                <input id="new-password" type="text" placeholder="Something you will remember..." required />
              </div>
              <button type="submit" class="btn btn-primary">Save &amp; Enter Hub</button>
            </form>
          </div>
        </div>
      </section>

      <section id="student-hub-section" style="display:none;">
        <div class="ev-container" style="padding:2.5rem 0 3.5rem;">
          <h1>Hi <span id="student-name-display">hero</span>, welcome to your Student Hub!</h1>
          
          <div class="dashboard-grid">
            <div class="card">
              <div class="card-header">Your Details</div>
              <div class="profile-header">
                <div class="profile-avatar-wrapper">
                  <img id="my-avatar" src="" alt="Avatar" class="current-avatar" />
                  <br>
                  <button id="btn-change-avatar" class="btn-change-avatar">Change</button>
                </div>
                <div class="profile-info">
                  <p>Name: <strong id="profile-name"></strong></p>
                  <p>Level: <strong id="profile-level"></strong></p>
                  <p>Subjects: <strong id="profile-subjects"></strong></p>
                  <p>Hero Points: <strong id="hero-stars-count">0</strong></p>
                </div>
              </div>
            </div>

            <div class="card">
              <div class="card-header">Attendance</div>
              <p class="helper-text">Class starting? Report in!</p>
              <button id="btn-attendance" class="btn btn-primary" style="width:100%">üôã‚Äç‚ôÇÔ∏è I'm Here!</button>
              
              <div style="margin-top:1.5rem;">
                <p class="helper-text">Join live lesson:</p>
                <a href="https://us06web.zoom.us/j/9900999009?pwd=4p3nEzSTnskpvfcIdaQrgRm7yfhrng.1" target="_blank" class="btn btn-ghost" style="width:100%;">Zoom Room</a>
              </div>
            </div>
            
            <div class="card" style="border: 2px solid var(--ev-accent); background: rgba(31, 230, 168, 0.05);">
              <div class="card-header">üèãÔ∏è The Writing Gym</div>
              <p class="helper-text">Complete drills to earn major XP.</p>
              <div id="gym-active-mission-container" style="margin-top:1rem;">
                <p class="helper-text">Scanning for missions...</p>
              </div>
            </div>

            <div class="card">
              <div class="card-header">Self Training</div>
              <p class="helper-text">Sharpen skills (Blooket).</p>
              <div id="training-buttons-container" style="display:flex; flex-direction:column; gap:0.5rem; margin-top:0.5rem;">
                <p class="helper-text">Loading...</p>
              </div>
            </div>
          </div>

          <div class="card" style="margin-top: 1rem;">
            <div class="card-header">Announcements</div>
            <div id="student-announcements"></div>
            <div class="student-section-footer">
              <button id="student-ann-toggle" type="button" class="btn btn-ghost btn-small" style="display:none;">Show older</button>
              <span id="student-ann-count" class="helper-text"></span>
            </div>
          </div>

          <div class="card">
            <div class="card-header">Homework &amp; Links</div>
            <div id="student-homework-list"></div>
            <div class="student-section-footer">
              <button id="student-hw-toggle" type="button" class="btn btn-ghost btn-small" style="display:none;">Show older</button>
              <span id="student-hw-count" class="helper-text"></span>
            </div>
          </div>

          <section class="dashboard-card">
            <div class="card-header">Chat with Teacher</div>
            <div id="chat-window" class="chat-window"></div>
            <form id="chat-form" class="chat-form">
              <div class="chat-row-inputs">
                <label class="chat-label">
                  <textarea id="chat-input" rows="2" placeholder="Message..."></textarea>
                </label>
                <div class="chat-attachments">
                  <label class="file-label">üìé <input type="file" id="chat-image" accept="image/*" /></label>
                </div>
              </div>
              <p id="chat-status" class="helper-text"></p>
              <div class="chat-actions">
                <button type="submit" class="btn btn-primary">Send</button>
              </div>
            </form>
          </section>
        </div>
      </section>
    </main>

    <footer class="ev-footer">
      <div class="ev-container">
        <p>¬© <span id="year"></span> Edvengers Student Hub.</p>
      </div>
    </footer>

    <div id="mission-overlay" class="mission-overlay hidden">
      <div class="mission-header">
        <span class="mission-title">‚ö° Resource View</span>
        <button class="btn btn-ghost btn-small" onclick="closeMission()">‚ùå Close</button>
      </div>
      <div class="mission-frame-container">
        <iframe id="mission-frame" src="" frameborder="0"></iframe>
      </div>
    </div>

    <div id="avatar-overlay" class="mission-overlay hidden">
      <div class="mission-header">
        <span class="mission-title">ü¶∏‚Äç‚ôÇÔ∏è Choose Identity</span>
        <button class="btn btn-ghost btn-small" id="close-avatar-btn">‚ùå Cancel</button>
      </div>
      <div class="mission-frame-container" style="background: var(--ev-bg); overflow-y: auto;">
        <div class="ev-container" style="padding-top: 2rem;">
          <h2 style="text-align:center;">Select Your Hero</h2>
          <div id="avatar-grid" class="avatar-grid"></div>
        </div>
      </div>
    </div>

    <div id="gym-overlay" class="gym-overlay hidden">
      <div class="gym-header">
        <span id="gym-mission-title" class="gym-header-title">Mission Title</span>
        <button class="btn btn-ghost btn-small" id="gym-exit-btn">‚ùå Return to HQ</button>
      </div>
      
      <div class="gym-gadget-belt" id="gym-gadget-belt">
        </div>

      <div class="gym-layout">
        <div class="gym-left-panel">
          <div style="color:var(--ev-muted); font-size:0.85rem; text-transform:uppercase; letter-spacing:1px; margin-bottom:0.5rem;">Briefing</div>
          <p id="gym-instructions" style="color:#fff; line-height:1.6; margin-bottom:1.5rem;"></p>
          <img id="gym-stimulus-image" class="gym-image hidden" />
        </div>
        <div class="gym-right-panel">
          <textarea id="gym-editor" class="gym-editor" placeholder="Begin your mission here..."></textarea>
        </div>
      </div>

      <div class="gym-footer">
        <span id="gym-word-count" class="word-count">Words: 0</span>
        <button id="gym-submit-btn" class="btn btn-primary">Submit Mission</button>
      </div>
    </div>

    <div id="flying-hero" class="flying-hero hidden">ü¶∏‚Äç‚ôÇÔ∏è</div>

    <script>document.getElementById("year").textContent = new Date().getFullYear();</script>
    <script src="app-student.js" type="module"></script>
  </body>
</html>